(()=>{var b=class{constructor(){this.state={playerNames:{yourName:null,opponentName:null},opponentTrackedCards:[]},this.callbacks=[]}onStateChange(t){this.callbacks.push(t)}notifyStateChange(){this.callbacks.forEach(t=>t(this))}async loadState(){return new Promise(t=>{chrome.storage.local.get("trackerState",r=>{r.trackerState&&(this.state=r.trackerState),t(this.state),this.notifyStateChange()})})}saveState(){chrome.storage.local.set({trackerState:this.state},()=>{this.notifyStateChange()})}updatePlayerNames(t,r){this.state.playerNames={yourName:t,opponentName:r},this.saveState()}addOpponentTrackedCard(t){this.state.opponentTrackedCards.includes(t)||(this.state.opponentTrackedCards.push(t),this.saveState())}removeOpponentTrackedCard(t){let r=this.state.opponentTrackedCards.indexOf(t);r!==-1&&(this.state.opponentTrackedCards.splice(r,1),this.saveState())}clearOpponentTrackedCards(){this.state.opponentTrackedCards=[],this.saveState()}getState(){return this.state}getOpponentName(){return this.state.playerNames.opponentName}getYourName(){return this.state.playerNames.yourName}getOpponentTrackedCards(){return this.state.opponentTrackedCards}},c=new b;function T(){let e=document.createElement("div");e.id="card-tracker-container",e.style.position="fixed",e.style.top="50%",e.style.right="10px",e.style.transform="translateY(65%)",e.style.backgroundColor="#f9f9f9",e.style.border="1px solid #ddd",e.style.borderRadius="10px",e.style.padding="15px",e.style.zIndex="10000",e.style.width="280px",e.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",e.style.fontFamily="Arial, sans-serif",e.style.fontSize="14px";let t=document.createElement("div");t.style.cursor="move",t.style.backgroundColor="#ddd",t.style.padding="10px",t.style.textAlign="center",t.style.borderBottom="1px solid #ccc",t.style.borderRadius="10px",t.textContent="Card Tracker",e.appendChild(t);let r=document.createElement("div");r.innerHTML=`
    <div id="tracker-list" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background-color: #fff;">
      <p style="text-align: center; color: #999;">No cards tracked yet.</p>
    </div>
    <div style="margin-top: 15px; display: flex; justify-content: space-between;">
      <button id="add-card-btn" style="
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
      ">
        Add Card
      </button>
      <button id="clear-cards-btn" style="
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
      ">
        Clear All
      </button>
    </div>
  `,e.appendChild(r),document.body.appendChild(e),V(e,t);let o=e.querySelector("#add-card-btn"),s=e.querySelector("#tracker-list");o.addEventListener("click",()=>{let a=prompt("Enter card name:");a&&c.addOpponentTrackedCard(a)}),e.querySelector("#clear-cards-btn").addEventListener("click",()=>{c.clearOpponentTrackedCards()})}function N(){let e=c.getOpponentTrackedCards(),t=document.querySelector("#tracker-list");t&&(t.innerHTML="",e.length>0?e.forEach(r=>{let o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.border="1px solid #ddd",o.style.borderRadius="4px",o.style.padding="5px",o.style.marginBottom="5px",o.style.backgroundColor="#f9f9f9";let s=document.createElement("span");s.textContent=r;let n=X();n.addEventListener("click",()=>{c.removeOpponentTrackedCard(r)}),o.appendChild(s),o.appendChild(n),t.appendChild(o)}):t.innerHTML='<p style="text-align: center; color: #666;">No cards tracked yet.</p>')}function V(e,t){let r=!1,o=0,s=0;t.addEventListener("mousedown",n=>{r=!0;let a=e.getBoundingClientRect();o=n.clientX-a.left,s=n.clientY-a.top,document.body.style.cursor="grabbing"}),document.addEventListener("mousemove",n=>{if(!r)return;let a=n.clientX-o,i=n.clientY-s;e.style.left=`${a}px`,e.style.top=`${i}px`,e.style.transform=""}),document.addEventListener("mouseup",()=>{r&&(r=!1,document.body.style.cursor="default")})}function X(){let e=document.createElement("button");return e.textContent="\xD7",e.style.backgroundColor="white",e.style.color="#f44336",e.style.border="none",e.style.borderRadius="50%",e.style.width="24px",e.style.height="24px",e.style.cursor="pointer",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontWeight="bold",e.style.fontSize="16px",e.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",e.style.transition="transform 0.2s ease, background-color 0.2s ease",e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.2)",e.style.backgroundColor="#fddcdc"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.backgroundColor="transparent"}),e}var x=class{constructor(){this.events={}}subscribe(t,r){this.events[t]||(this.events[t]=[]),this.events[t].push(r)}unsubscribe(t,r){this.events[t]&&(this.events[t]=this.events[t].filter(o=>o!==r))}publish(t,r){console.log("publishing event ",t,r),this.events[t]&&this.events[t].forEach(o=>o(r))}},p=new x;var P="Rock",R="Water",L="Herbivore",I="Bird",O="Primate";var l="DRAW",u="PLAY",C="SKIP",y="START",f="END",S="RESISTANCE";var _=[{regex:/^(.*) is now/,action:C},{regex:/^You draw (.*) from the deck \(scoring cards\)/,action:y},{regex:/^The end of the game: (.*) wins!/,action:f},{regex:/^(.*) takes (.*) in reputation range from the display/,action:l},{regex:/^(.*) snaps (.*) from the display/,action:l},{regex:/^(.*) draws (.*) sponsor/,action:l},{regex:/^(.*) draws 1 .*: (.*)/,action:l},{regex:/keeps 1 scoring card and discard 1 scoring card for resistance effect/,action:S},{regex:/^(.*) keeps (.*?) card/,action:l},{regex:/^(.*) takes (.*?) from the display/,action:l},{regex:/^(.*) plays (.*) for/,action:u},{regex:/^(.*) plays a new conservation project: (.*)/,action:u},{regex:/^(.*) plays (.*)/,action:u}];function $(e){for(let{regex:t,action:r}of _){let o=e.match(t);if(o){if(r===C)return;if(r===y){p.publish(y);return}if(r===f){p.publish(f);return}if(r===S)return;let s=o[1]?o[1].trim():void 0;(o[2]?o[2].trim():void 0).split(",").forEach(a=>{a=a.trim(),isNaN(a)&&(r===l&&p.publish(l,{playerName:s,cardName:a}),r===u&&p.publish(u,{playerName:s,cardName:a}))});return}}}function w(){let e=document.querySelector("#logs");if(!e)return;new MutationObserver(r=>{r.forEach(o=>{o.addedNodes.length>0&&o.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){s.querySelectorAll(".timestamp").forEach(a=>a.remove());let n=s.textContent.trim().replace(/\n|\r/g,"");console.log(n),$(n)}})})}).observe(e,{childList:!0,subtree:!1})}function B(){let e=document.querySelectorAll(".player-name"),t=e?e[0]:null,r=e?e[1]:null,o=t?t.textContent.trim():null,s=r?r.textContent.trim():null;c.updatePlayerNames(o,s)}function q(e,t=300){let r;return function(...o){clearTimeout(r),r=setTimeout(()=>e.apply(this,o),t)}}function j(){let e=[];document.querySelectorAll("#base-projects-holder .project-holder").forEach(a=>{let i=a.querySelector(".badge-icon");if(i){let d=i.getAttribute("data-type");d&&e.push({type:"BASE",projectType:d})}});function r(a){let i=a.querySelector(".badge-icon"),d=a.querySelector(".icon-partner-zoo"),g=a.querySelector(".icon-release-animal");if(i){let m=i.getAttribute("data-type");m&&(d&&e.push({type:"PROG",projectType:m}),g&&e.push({type:"RELEASE",projectType:m}))}}return document.querySelectorAll("#projects-holder .project-holder").forEach(r),document.querySelectorAll("#cards-pool .project-card").forEach(r),document.querySelectorAll(".player-board-hand .project-card").forEach(r),e}var k={Aquarium:[R],CableCar:[P],Vetenarian:[],MeerkatDen:[L],PenguinPool:[I],BaboonRock:[O]};function D(){let e=document.querySelectorAll(".player-board-inPlay-sponsors"),t=e[0],r=e[1];return{yourBoard:t,opponentBoard:r}}function M(){let{yourBoard:e,opponentBoard:t}=D(),r=e.querySelectorAll(".sponsor-card"),o=[];return r.forEach(s=>{let n=E(s);o.push(n)}),o}function W(){let{yourBoard:e,opponentBoard:t}=D(),r=t.querySelectorAll(".sponsor-card"),o=[];return r.forEach(n=>{let a=E(n);o.push(a)}),e.querySelectorAll(".sponsor-card").forEach(n=>{let a=E(n);o.push(a)}),o}function E(e){let r=(e.id||"").match(/^card-[^_]+_(.+)$/);return r?r[1]:null}function Y(){let e=[];return W().forEach(r=>{r in k&&(e=[...e,...k[r]])}),e}function v(e){let t=e.querySelector(".ark-card-top-right");if(!t)return[];let r=t.querySelectorAll(".badge-icon"),o=new Set(Array.from(r).map(n=>n.getAttribute("data-type"))),s=e.querySelector(".ark-card-top-left");if(s){let n=s.querySelector(".icon-enclosure-regular-water, .icon-enclosure-regular-water-water, .icon-enclosure-regular-rock, .icon-enclosure-regular-rock-rock");n&&(n.classList.contains("icon-enclosure-regular-water")&&o.add("Water"),n.classList.contains("icon-enclosure-regular-water-water")&&o.add("Water"),n.classList.contains("icon-enclosure-regular-rock")&&o.add("Rock"),n.classList.contains("icon-enclosure-regular-rock-rock")&&o.add("Rock"))}return Array.from(o)}function Q(e,t){let r=v(e),o=[];for(let s of t)r.includes(s.projectType)&&o.push(s);return o}function J(e,t){let r=v(e),o=[];for(let s of t)r.includes(s)&&o.push({type:"SPONSOR"});return o}function Z(e,t){[".card-pool-folder .ark-card",".player-board-hand .ark-card"].forEach(o=>{document.querySelectorAll(o).forEach(n=>{if(n.getAttribute("data-unmarked")==="true")return;let a=Q(n,e),i=J(n,t),d=[...a,...i];ee(n,d)})})}function ee(e,t){let r=e.querySelector(".tag-container");if(r&&r.remove(),!t.length){U(e);return}re(e),oe(e),r=document.createElement("div"),r.className="tag-container",r.style.position="absolute",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",e.style.position="relative",e.appendChild(r),t.forEach(o=>{let s=te(o.type,o.type);r.appendChild(s)})}var F={DEFAULT:"#9E9E9E",BASE:"#4CAF50",RELEASE:"#FF0000",PROG:"#FFA500",SPONSOR:"#0000FF"};function te(e,t){let r=F[t]||F.DEFAULT,o=document.createElement("div");return o.textContent=e,o.className="tag-container-badge-matching-project",o.style.backgroundColor=r,o.style.color="white",o.style.borderRadius="12px",o.style.padding="5px 10px",o.style.marginBottom="4px",o.style.fontSize="14px",o.style.fontWeight="bold",o.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",o.style.pointerEvents="none",o}function A(){let e=j(),t=Y();Z(e,t)}function z(){["#cards-pool",".player-board-hand"].forEach(r=>{let o=document.querySelector(r);if(o){let s=q(()=>{n.disconnect(),A(),setTimeout(()=>{n.observe(o,{childList:!0,subtree:!0})},300)}),n=new MutationObserver(a=>{a.filter(d=>{let g=d.target.classList.contains("card-overlay"),m=d.target.classList.contains("tag-container"),H=d.target.classList.contains("tag-container-badge");return!(g||m||H)}).length>0&&s()});n.observe(o,{childList:!0,subtree:!0})}}),[".player-board-cards"].forEach(r=>{let o=document.querySelector(r);o&&new MutationObserver(n=>{n.forEach(a=>{a.addedNodes.length>0&&a.addedNodes.forEach(i=>{i.classList&&i.classList.contains("ark-card")&&G(i)})})}).observe(o,{childList:!0,subtree:!0})})}function re(e){if(e.querySelector(".card-overlay"))return;e.style.position="relative";let t=document.createElement("div");t.className="card-overlay",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.border="3px solid yellow",t.style.pointerEvents="none",t.style.borderRadius="inherit",t.style.boxSizing="border-box",e.appendChild(t)}function U(e){let t=e.querySelector(".card-overlay");if(t)t.remove();else return}function oe(e){let t=e.querySelector(".unmark-button");t||(t=document.createElement("button"),t.textContent="\xD7",t.className="unmark-button",t.style.position="absolute",t.style.top="30%",t.style.right="10px",t.style.transform="translateY(-50%)",t.style.backgroundColor="Orange",t.style.color="white",t.style.border="none",t.style.borderRadius="50%",t.style.width="20px",t.style.height="20px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.fontSize="16px",t.style.cursor="pointer",t.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.2)",t.style.zIndex="1000",t.addEventListener("click",r=>{r.stopPropagation(),se(e)}),e.appendChild(t))}function ne(e){let t=e.querySelector(".unmark-button");if(t)t.remove();else return}function se(e){G(e),e.setAttribute("data-unmarked","true")}function G(e){let t=e.querySelector(".tag-container");t&&t.remove(),U(e),ne(e)}var h=class{constructor(){p.subscribe(l,this.handleCardDrawn.bind(this)),p.subscribe(u,this.handleCardPlayed.bind(this)),p.subscribe(y,this.handleGameStart.bind(this)),p.subscribe(f,this.handleGameEnd.bind(this))}handleCardDrawn({playerName:t,cardName:r}){t===c.getOpponentName()&&c.addOpponentTrackedCard(r)}handleCardPlayed({playerName:t,cardName:r}){t===c.getOpponentName()&&c.removeOpponentTrackedCard(r)}handleGameStart(){c.clearOpponentTrackedCards()}handleGameEnd(){c.clearOpponentTrackedCards()}};function K(){c.loadState(),c.onStateChange(N),cardTracker=new h,T(),setTimeout(()=>{B(),A(),w(),z(),M()},1e3)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{K(c)}):K(c);})();
//# sourceMappingURL=bundledContent.js.map
